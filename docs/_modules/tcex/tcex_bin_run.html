

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>tcex.tcex_bin_run &mdash; TcEx 0.9.4 documentation</title>















  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />


  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">


  <div class="wy-grid-for-nav">


    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">



            <a href="../../index.html" class="icon icon-home"> TcEx



          </a>




              <div class="version">
                0.9.4
              </div>




<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">






              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building_apps_quickstart.html">Building Apps - Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building_apps_tcinit.html">Building Apps - Templates (tcinit)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building_apps_tclib.html">Building Apps - Dependencies (tclib)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building_apps_tcpackage.html">Building Apps - Packaging (tcpackage)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing_apps_tcprofile.html">Testing Apps - Profiles (tcprofile)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing_apps_tcrun.html">Testing Apps - Running Profiles (tcrun)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_deployment_configuration.html">App - Deployment Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_directory_structure.html">App - Directory Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_batch.html">Module - Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_metrics.html">Module - Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_notifications.html">Module - Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_playbook.html">Module - Playbooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_request.html">Module - Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_resource.html">Module - Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_utils.html">Module - Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authorization.html">Authorization (Token / HMAC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../exit.html">Exit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../message_tc.html">Message TC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parser.html">Parser / Args</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../proxies.html">Proxies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../results_tc.html">Results TC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tcex_docs/modules.html">tcex</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">


      <nav class="wy-nav-top" aria-label="top navigation">

          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TcEx</a>

      </nav>


      <div class="wy-nav-content">

        <div class="rst-content">

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">

      <li><a href="../../index.html">Docs</a> &raquo;</li>

          <li><a href="../index.html">Module code</a> &raquo;</li>

      <li>tcex.tcex_bin_run</li>


      <li class="wy-breadcrumbs-aside">

      </li>

  </ul>


  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <h1>Source code for tcex.tcex_bin_run</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;TcEx Framework App Testing Module.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">difflib</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">six</span> <span class="k">import</span> <span class="n">string_types</span>
<span class="kn">import</span> <span class="nn">colorama</span> <span class="k">as</span> <span class="nn">c</span>


<span class="kn">from</span> <span class="nn">tcex</span> <span class="k">import</span> <span class="n">TcEx</span>


<div class="viewcode-block" id="TcExRun"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun">[docs]</a><span class="k">class</span> <span class="nc">TcExRun</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run profiles for App.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize Class properties.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_signal_handler_init</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_staging_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reports</span> <span class="o">=</span> <span class="n">Reports</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docker_image</span> <span class="o">=</span> <span class="s1">&#39;tcintegrations/tci-dev:latest&#39;</span>

        <span class="c1"># logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_redis_tracker</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">json_report</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_diff</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># data from install.json</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program_main</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program_version</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runtime_level</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shell</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># removing this value as it appears to cause an issue with some characters in args</span>
        <span class="c1"># if platform.system() == &#39;Windows&#39;:</span>
        <span class="c1">#    self.shell = True</span>

        <span class="c1"># initialize colorama</span>
        <span class="n">c</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">autoreset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="TcExRun._create_tc_dirs"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun._create_tc_dirs">[docs]</a>    <span class="k">def</span> <span class="nf">_create_tc_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create app directories for logs and data files.&quot;&quot;&quot;</span>
        <span class="n">tc_log_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tc_log_path&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tc_log_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tc_log_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">tc_log_path</span><span class="p">)</span>
        <span class="n">tc_out_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tc_out_path&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tc_out_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tc_out_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">tc_out_path</span><span class="p">)</span>
        <span class="n">tc_tmp_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tc_tmp_path&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tc_tmp_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tc_tmp_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">tc_tmp_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun._load_config_include"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun._load_config_include">[docs]</a>    <span class="k">def</span> <span class="nf">_load_config_include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_directory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load included configuration files.&quot;&quot;&quot;</span>
        <span class="n">include_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_path</span><span class="p">,</span> <span class="n">include_directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">include_directory</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Provided include directory does not exist (</span><span class="si">{}</span><span class="s1">).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">include_directory</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">profiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">include_directory</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Loading config: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Include File: </span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">MAGENTA</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
                <span class="n">config_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">include_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">profiles</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_file</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid JSON file: </span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">profiles</span></div>

<div class="viewcode-block" id="TcExRun._logger"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun._logger">[docs]</a>    <span class="k">def</span> <span class="nf">_logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create logger instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            logger: An instance of logging</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_level</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
            <span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
            <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
            <span class="s1">&#39;critical&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">log_level</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">logging_level</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="c1"># Formatter</span>
        <span class="n">tx_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1"> &#39;</span>
        <span class="n">tx_format</span> <span class="o">+=</span> <span class="s1">&#39;(</span><span class="si">%(funcName)s</span><span class="s1">:</span><span class="si">%(lineno)d</span><span class="s1">)&#39;</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">tx_format</span><span class="p">)</span>

        <span class="c1"># Logger</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;tcrun&#39;</span><span class="p">)</span>

        <span class="c1"># # Stream Handler</span>
        <span class="c1"># sh = logging.StreamHandler()</span>
        <span class="c1"># sh.set_name(&#39;sh&#39;)</span>
        <span class="c1"># sh.setLevel(level)</span>
        <span class="c1"># sh.setFormatter(formatter)</span>
        <span class="c1"># log.addHandler(sh)</span>

        <span class="c1"># File Handler</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">logfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;run.log&#39;</span><span class="p">)</span>
        <span class="n">fh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;fh&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Logging Level: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">getLevelName</span><span class="p">(</span><span class="n">level</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">log</span></div>

    <span class="k">def</span> <span class="nf">_signal_handler_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># catch interupt signals</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIG_IGN</span><span class="p">)</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_handler</span><span class="p">)</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_handler</span><span class="p">)</span>

<div class="viewcode-block" id="TcExRun._signal_handler"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun._signal_handler">[docs]</a>    <span class="k">def</span> <span class="nf">_signal_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal_interupt</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>  <span class="c1"># pylint: disable=W0613</span>
        <span class="sd">&quot;&quot;&quot;Handle singal interrupt.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">Stopping docker container.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">Interrupt signal received.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tcrun received an interrupt signal and will now exit.&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_tcex_required_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get just the args required for data services.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;api_access_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;api_secret_key&#39;</span><span class="p">,</span>
            <span class="c1"># &#39;tc_log_level&#39;,</span>
            <span class="s1">&#39;tc_api_path&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_log_file&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_log_path&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_out_path&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_playbook_db_context&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_playbook_db_path&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_playbook_db_port&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_playbook_db_type&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_proxy_external&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_proxy_host&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_proxy_port&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_proxy_password&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_proxy_tc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_proxy_username&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tc_temp_path&#39;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_vars_match</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Regular expression to match playbook variable.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s1">&#39;#([A-Za-z]+)&#39;</span>  <span class="c1"># match literal (#App) at beginning of String</span>
            <span class="sa">r</span><span class="s1">&#39;:([\d]+)&#39;</span>  <span class="c1"># app id (:7979)</span>
            <span class="sa">r</span><span class="s1">&#39;:([A-Za-z0-9_\.\-\[\]]+)&#39;</span>  <span class="c1"># variable name (:variable_name)</span>
            <span class="sa">r</span><span class="s1">&#39;!(StringArray|BinaryArray|KeyValueArray&#39;</span>  <span class="c1"># variable type (array)</span>
            <span class="sa">r</span><span class="s1">&#39;|TCEntityArray|TCEnhancedEntityArray&#39;</span>  <span class="c1"># variable type (array)</span>
            <span class="sa">r</span><span class="s1">&#39;|String|Binary|KeyValue|TCEntity|TCEnhancedEntity&#39;</span>  <span class="c1"># variable type</span>
            <span class="sa">r</span><span class="s1">&#39;|(?:(?!String)(?!Binary)(?!KeyValue)&#39;</span>  <span class="c1"># non matching for custom</span>
            <span class="sa">r</span><span class="s1">&#39;(?!TCEntity)(?!TCEnhancedEntity)&#39;</span>  <span class="c1"># non matching for custom</span>
            <span class="sa">r</span><span class="s1">&#39;[A-Za-z0-9_-]+))&#39;</span>  <span class="c1"># variable type (custom)</span>
        <span class="p">)</span>

<div class="viewcode-block" id="TcExRun.autoclear"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.autoclear">[docs]</a>    <span class="k">def</span> <span class="nf">autoclear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear Redis and ThreatConnect data from staging data.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staging_data</span><span class="p">:</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_type&#39;</span><span class="p">,</span> <span class="s1">&#39;redis&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;redis&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_redis</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">),</span> <span class="s1">&#39;auto-clear&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;redis-array&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_redis</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">),</span> <span class="s1">&#39;auto-clear&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">variables</span> <span class="ow">in</span> <span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variables&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">clear_redis</span><span class="p">(</span><span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="s1">&#39;auto-clear&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;threatconnect&#39;</span><span class="p">:</span>
                <span class="c1"># self.clear_tc(sd.get(&#39;data_owner&#39;), sd.get(&#39;data&#39;, {}), &#39;auto-clear&#39;)</span>
                <span class="c1"># self.clear_redis(sd.get(&#39;variable&#39;), &#39;auto-clear&#39;)</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;threatconnect-association&#39;</span><span class="p">:</span>
                <span class="c1"># assuming these have already been cleared</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;threatconnect-batch&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">clear_tc</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_owner&#39;</span><span class="p">),</span> <span class="n">group</span><span class="p">,</span> <span class="s1">&#39;auto-clear&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">clear_redis</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">),</span> <span class="s1">&#39;auto-clear&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;indicator&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">clear_tc</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_owner&#39;</span><span class="p">),</span> <span class="n">indicator</span><span class="p">,</span> <span class="s1">&#39;auto-clear&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">clear_redis</span><span class="p">(</span><span class="n">indicator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">),</span> <span class="s1">&#39;auto-clear&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;validations&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="n">vd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_type&#39;</span><span class="p">,</span> <span class="s1">&#39;redis&#39;</span><span class="p">)</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">vd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;redis&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_redis</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="s1">&#39;auto-clear&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.clear"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear Redis and ThreatConnect data defined in profile.</span>

<span class="sd">        Redis Data:</span>

<span class="sd">        .. code-block:: javascript</span>

<span class="sd">            {</span>
<span class="sd">              &quot;data_type&quot;: &quot;redis&quot;,</span>
<span class="sd">              &quot;variable&quot;: &quot;#App:4768:tc.adversary!TCEntity&quot;</span>
<span class="sd">            }</span>

<span class="sd">        ThreatConnect Data:</span>

<span class="sd">        .. code-block:: javascript</span>

<span class="sd">            {</span>
<span class="sd">              &quot;data_type&quot;: &quot;threatconnect&quot;,</span>
<span class="sd">              &quot;owner&quot;: &quot;TCI&quot;,</span>
<span class="sd">              &quot;type&quot;: &quot;Address&quot;,</span>
<span class="sd">              &quot;value&quot;: &quot;1.1.1.1&quot;</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">clear_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="n">clear_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;redis&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_redis</span><span class="p">(</span><span class="n">clear_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">),</span> <span class="s1">&#39;clear&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">clear_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;threatconnect&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_tc</span><span class="p">(</span><span class="n">clear_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;owner&#39;</span><span class="p">),</span> <span class="n">clear_data</span><span class="p">,</span> <span class="s1">&#39;clear&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.clear_redis"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.clear_redis">[docs]</a>    <span class="k">def</span> <span class="nf">clear_redis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">clear_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete redis data for provided variable.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clear_redis_tracker</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vars_match</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[</span><span class="si">{}</span><span class="s1">] Deleting redis variable: </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clear_type</span><span class="p">,</span> <span class="n">variable</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clearing Variables: </span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">MAGENTA</span><span class="p">,</span> <span class="n">variable</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_redis_tracker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.clear_tc"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.clear_tc">[docs]</a>    <span class="k">def</span> <span class="nf">clear_tc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">clear_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete ThreatConnect data.&quot;&quot;&quot;</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;Delete&#39;</span><span class="p">)</span>
        <span class="n">tc_type</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tc_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">group_types</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_data</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s1">&#39;Deleting ThreatConnect Group: </span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">MAGENTA</span><span class="p">,</span> <span class="n">name</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;[</span><span class="si">{}</span><span class="s1">] Deleting ThreatConnect </span><span class="si">{}</span><span class="s1"> with name: </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">clear_type</span><span class="p">,</span> <span class="n">tc_type</span><span class="p">,</span> <span class="n">name</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">batch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">tc_type</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tc_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">indicator_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;summary&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;summary&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="n">tc_type</span><span class="p">)</span>
                <span class="n">summary</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_data</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">summary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s1">&#39;Deleting ThreatConnect Indicator: </span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">MAGENTA</span><span class="p">,</span> <span class="n">summary</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;[</span><span class="si">{}</span><span class="s1">] Deleting ThreatConnect </span><span class="si">{}</span><span class="s1"> with value: </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">clear_type</span><span class="p">,</span> <span class="n">tc_type</span><span class="p">,</span> <span class="n">summary</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">batch</span><span class="o">.</span><span class="n">indicator</span><span class="p">(</span><span class="n">tc_type</span><span class="p">,</span> <span class="n">summary</span><span class="p">)</span>
        <span class="n">batch_results</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;[</span><span class="si">{}</span><span class="s1">] Batch Results: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clear_type</span><span class="p">,</span> <span class="n">batch_results</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">batch_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;errors&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;[</span><span class="si">{}</span><span class="s1">] Batch Error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clear_type</span><span class="p">,</span> <span class="n">error</span><span class="p">))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return configuration data.</span>

<span class="sd">        Load on first access, otherwise return existing data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Provided config file does not exist (</span><span class="si">{}</span><span class="s1">).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;Configuration File: </span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">CYAN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>

            <span class="c1"># load includes</span>
            <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_include_dirs&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;profiles&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_load_config_include</span><span class="p">(</span><span class="n">directory</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span>

<div class="viewcode-block" id="TcExRun.data_endswith"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.data_endswith">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">data_endswith</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate data ends with user data.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">db_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">db_data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">user_data</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TcExRun.data_in_db"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.data_in_db">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">data_in_db</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate db data in user data.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">db_data</span> <span class="ow">in</span> <span class="n">user_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TcExRun.data_in_user"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.data_in_user">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">data_in_user</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate user data in db data.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">user_data</span> <span class="ow">in</span> <span class="n">db_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TcExRun.data_it"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.data_it">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">data_it</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate data is Type.&quot;&quot;&quot;</span>
        <span class="n">data_type</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;array&#39;</span><span class="p">:</span> <span class="p">(</span><span class="nb">list</span><span class="p">),</span>
            <span class="c1"># &#39;binary&#39;: (string_types),</span>
            <span class="c1"># &#39;bytes&#39;: (string_types),</span>
            <span class="s1">&#39;dict&#39;</span><span class="p">:</span> <span class="p">(</span><span class="nb">dict</span><span class="p">),</span>
            <span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="p">(</span><span class="nb">dict</span><span class="p">),</span>
            <span class="s1">&#39;list&#39;</span><span class="p">:</span> <span class="p">(</span><span class="nb">list</span><span class="p">),</span>
            <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">string_types</span><span class="p">),</span>
            <span class="s1">&#39;string&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">string_types</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="c1"># user_type_tuple = tuple([data_type[t] for t in user_types])</span>
        <span class="c1"># if isinstance(db_data, user_type_tuple):</span>
        <span class="k">if</span> <span class="n">user_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">db_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">user_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;null&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">db_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">user_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s1">&#39;binary&#39;</span><span class="p">:</span>
            <span class="c1"># this test is not 100%, but should be good enough</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">db_data</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">data_type</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">data_type</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TcExRun.data_kva_compare"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.data_kva_compare">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">data_kva_compare</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate key/value data in KeyValueArray.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">kv_data</span> <span class="ow">in</span> <span class="n">db_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kv_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">kv_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TcExRun.data_not_in"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.data_not_in">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">data_not_in</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate data not in user data.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">db_data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TcExRun.data_startswith"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.data_startswith">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">data_startswith</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate data starts with user data.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">db_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">db_data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">user_data</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TcExRun.data_string_compare"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.data_string_compare">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">data_string_compare</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate string removing all white space before comparison.&quot;&quot;&quot;</span>
        <span class="n">db_data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">db_data</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="n">user_data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">user_data</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TcExRun.deep_diff"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.deep_diff">[docs]</a>    <span class="k">def</span> <span class="nf">deep_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate data in user data.&quot;&quot;&quot;</span>
        <span class="c1"># NOTE: tcex does include the deepdiff library as a dependencies since it is only</span>
        <span class="c1"># required for local testing.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">deepdiff</span> <span class="k">import</span> <span class="n">DeepDiff</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not import DeepDiff module (try &quot;pip install deepdiff&quot;).&#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ddiff</span> <span class="o">=</span> <span class="n">DeepDiff</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">,</span> <span class="n">ignore_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">ddiff</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;[validate] Diff      : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ddiff</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TcExRun.json_compare"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.json_compare">[docs]</a>    <span class="k">def</span> <span class="nf">json_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate data in user data.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="p">(</span><span class="n">string_types</span><span class="p">)):</span>
            <span class="n">db_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">db_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="p">(</span><span class="n">string_types</span><span class="p">)):</span>
            <span class="n">user_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deep_diff</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.load_install_json"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.load_install_json">[docs]</a>    <span class="k">def</span> <span class="nf">load_install_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return install.json data.</span>

<span class="sd">        Load on first access, otherwise return existing data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">install_json</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">load_output</span> <span class="o">=</span> <span class="s1">&#39;Load install.json: </span><span class="si">{}{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">CYAN</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Loading install.json: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">config_data</span><span class="p">:</span>
                <span class="n">install_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_data</span><span class="p">)</span>
            <span class="n">load_output</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">{}{}</span><span class="s1">(Loaded)</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">load_output</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">{}{}</span><span class="s1">(Not Found)</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span>
            <span class="p">)</span>

        <span class="c1"># display load status</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">load_output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">install_json</span></div>

<div class="viewcode-block" id="TcExRun.load_tcex"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.load_tcex">[docs]</a>    <span class="k">def</span> <span class="nf">load_tcex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Inject required TcEx CLI Args.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_args&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tcex_required_args</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># add new log file name and level</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--tc_log_file&#39;</span><span class="p">,</span> <span class="s1">&#39;tcex.log&#39;</span><span class="p">])</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--tc_log_level&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">])</span>
            <span class="c1"># format key</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="s1">&#39;--</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
                <span class="c1"># handle bool values as flags (e.g., --flag) with no value</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span> <span class="o">=</span> <span class="n">TcEx</span><span class="p">()</span>

        <span class="c1"># reset singal handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_signal_handler_init</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">operators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return dict of Validation Operators.</span>

<span class="sd">        + deep-diff (dd): This operator can compare any object that can be represented as JSON.</span>
<span class="sd">        + eq: This operator does a equal to comparison for String and StringArray variables.</span>
<span class="sd">        + ends-with (ew): This operator compares the end of a String with a user provided value.</span>
<span class="sd">        + ge: This operator does a greater than or equal to comparison for String variables.</span>
<span class="sd">        + gt: This operator does a greater than comparison for String variables.</span>
<span class="sd">        + json-compare (jc): This operator will convert a String output variable to a JSON object</span>
<span class="sd">          (dict) and compare to user provided data.</span>
<span class="sd">        + key-value-compare (kva): This operator will validate that key/value data is in</span>
<span class="sd">          KeyValueArray.</span>
<span class="sd">        + in: This operator will check to see if a String output variable is in an user provided</span>
<span class="sd">          array.</span>
<span class="sd">        + in-user-data: This operator will validate that user provided String value is in output</span>
<span class="sd">          StringArray variable.</span>
<span class="sd">        + not-in (ni): This operator will check to see if a String variable is **not** in an user</span>
<span class="sd">          provided array.</span>
<span class="sd">        + is-type (it): This operator will check to see if the variable &quot;type&quot; is equal to the user</span>
<span class="sd">          provided &quot;type&quot;.</span>
<span class="sd">        + le: This operator does a less than or equal to comparison for String variables.</span>
<span class="sd">        + lt: This operator does a less than comparison for String variables.</span>
<span class="sd">        + ne: This operator does a **not** equal to comparison for String and StringArray variables.</span>
<span class="sd">        + string-compare (se):</span>
<span class="sd">        + starts-with (sw): This operator compares the start of a String with a user provided value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;dd&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">deep_diff</span><span class="p">,</span>
            <span class="s1">&#39;deep-diff&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">deep_diff</span><span class="p">,</span>
            <span class="s1">&#39;eq&#39;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>
            <span class="s1">&#39;ew&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_endswith</span><span class="p">,</span>
            <span class="s1">&#39;ends-with&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_endswith</span><span class="p">,</span>
            <span class="s1">&#39;ge&#39;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">ge</span><span class="p">,</span>
            <span class="s1">&#39;gt&#39;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">gt</span><span class="p">,</span>
            <span class="s1">&#39;jc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_compare</span><span class="p">,</span>
            <span class="s1">&#39;json-compare&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_compare</span><span class="p">,</span>
            <span class="s1">&#39;kva&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_kva_compare</span><span class="p">,</span>
            <span class="s1">&#39;key-value-compare&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_kva_compare</span><span class="p">,</span>
            <span class="s1">&#39;in&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in_db</span><span class="p">,</span>
            <span class="s1">&#39;in-db-data&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in_db</span><span class="p">,</span>
            <span class="s1">&#39;in-user-data&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in_user</span><span class="p">,</span>
            <span class="s1">&#39;ni&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_not_in</span><span class="p">,</span>
            <span class="s1">&#39;not-in&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_not_in</span><span class="p">,</span>
            <span class="s1">&#39;it&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_it</span><span class="p">,</span>  <span class="c1"># is type</span>
            <span class="s1">&#39;is-type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_it</span><span class="p">,</span>
            <span class="s1">&#39;lt&#39;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">lt</span><span class="p">,</span>
            <span class="s1">&#39;le&#39;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">,</span>
            <span class="s1">&#39;ne&#39;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span><span class="p">,</span>
            <span class="s1">&#39;se&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_string_compare</span><span class="p">,</span>
            <span class="s1">&#39;string-compare&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_string_compare</span><span class="p">,</span>
            <span class="s1">&#39;sw&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_startswith</span><span class="p">,</span>
            <span class="s1">&#39;starts-with&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_startswith</span><span class="p">,</span>
        <span class="p">}</span>

<div class="viewcode-block" id="TcExRun.path_data"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.path_data">[docs]</a>    <span class="k">def</span> <span class="nf">path_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable_data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return jmespath data.&quot;&quot;&quot;</span>
        <span class="c1"># NOTE: tcex does include the jmespath library as a dependencies since it is only</span>
        <span class="c1"># required for local testing.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">jmespath</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not import jmespath module (try &quot;pip install jmespath&quot;).&#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="c1"># try to convert string into list/dict before using expression</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">variable_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">variable_data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;String value (</span><span class="si">{}</span><span class="s1">) could not JSON serialized.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_data</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">expression</span> <span class="o">=</span> <span class="n">jmespath</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">variable_data</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="n">variable_data</span><span class="p">,</span> <span class="n">jmespath</span><span class="o">.</span><span class="n">Options</span><span class="p">(</span><span class="n">dict_cls</span><span class="o">=</span><span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">variable_data</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the current profile.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span>

    <span class="nd">@profile</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the current profile.&quot;&quot;&quot;</span>
        <span class="c1"># clear staging data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_staging_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># retrieve language from install.json or assume Python</span>
        <span class="n">lang</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install_json&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;programLanguage&#39;</span><span class="p">,</span> <span class="s1">&#39;PYTHON&#39;</span><span class="p">)</span>
        <span class="c1"># load instance of ArgBuilder</span>
        <span class="n">profile_args</span> <span class="o">=</span> <span class="n">ArgBuilder</span><span class="p">(</span><span class="n">lang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_args</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">)))</span>
        <span class="c1"># set current profile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="n">profile</span>
        <span class="c1"># attach instance to current profile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="p">[</span><span class="s1">&#39;profile_args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile_args</span>
        <span class="c1"># load tcex module after current profile is set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_tcex</span><span class="p">()</span>
        <span class="c1"># select report for current profile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_name&#39;</span><span class="p">))</span>
        <span class="c1"># create required directories for tcrun to function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_tc_dirs</span><span class="p">()</span>

<div class="viewcode-block" id="TcExRun.profile_args"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.profile_args">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">profile_args</span><span class="p">(</span><span class="n">_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return args for old or new structure.&quot;&quot;&quot;</span>
        <span class="c1"># TODO: clean this up in a way that works for both py2/3</span>
        <span class="k">if</span> <span class="n">_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># detect new args structure</span>
            <span class="n">app_args</span> <span class="o">=</span> <span class="n">_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">default_args</span> <span class="o">=</span> <span class="n">_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">_args</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">app_args</span><span class="p">)</span>
            <span class="n">_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">default_args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_args</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">profiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all selected profiles.&quot;&quot;&quot;</span>
        <span class="n">selected_profiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profiles&#39;</span><span class="p">):</span>

            <span class="n">profile_selected</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">profile_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_name&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">profile_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">profile</span><span class="p">:</span>
                <span class="n">profile_selected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">group</span><span class="p">:</span>
                <span class="n">profile_selected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">group</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">profile_selected</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">profile_selected</span><span class="p">:</span>
                <span class="n">install_json_filename</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install_json&#39;</span><span class="p">)</span>
                <span class="n">ij</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">install_json_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_install_json</span><span class="p">(</span><span class="n">install_json_filename</span><span class="p">)</span>
                <span class="n">config</span><span class="p">[</span><span class="s1">&#39;install_json&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ij</span>
                <span class="n">selected_profiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="o">.</span><span class="n">add_profile</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">profile_selected</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">selected_profiles</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">No profiles selected to run.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">selected_profiles</span>

<div class="viewcode-block" id="TcExRun.report"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format and output report data to screen.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">CYAN</span><span class="p">,</span> <span class="s1">&#39;Report:&#39;</span><span class="p">))</span>
        <span class="c1"># report headers</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{!s:&lt;85}{!s:&lt;20}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Validations&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">{!s:&lt;60}{!s:&lt;25}{!s:&lt;10}{!s:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;Profile:&#39;</span><span class="p">,</span> <span class="s1">&#39;Execution:&#39;</span><span class="p">,</span> <span class="s1">&#39;Passed:&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed:&#39;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">data</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># execution</span>
            <span class="n">execution_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span>
            <span class="n">execution_text</span> <span class="o">=</span> <span class="s1">&#39;Failed&#39;</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;execution_success&#39;</span><span class="p">):</span>
                <span class="n">execution_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span>
                <span class="n">execution_text</span> <span class="o">=</span> <span class="s1">&#39;Passed&#39;</span>

            <span class="c1"># pass count</span>
            <span class="n">pass_count_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span>
            <span class="n">pass_count</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;validation_pass_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1"># fail count</span>
            <span class="n">fail_count</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;validation_fail_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">fail_count_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span>
            <span class="k">if</span> <span class="n">fail_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fail_count_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span>

            <span class="c1"># report row</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{!s:&lt;60}{}{!s:&lt;25}{}{!s:&lt;10}{}{!s:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
                    <span class="n">execution_color</span><span class="p">,</span>
                    <span class="n">execution_text</span><span class="p">,</span>
                    <span class="n">pass_count_color</span><span class="p">,</span>
                    <span class="n">pass_count</span><span class="p">,</span>
                    <span class="n">fail_count_color</span><span class="p">,</span>
                    <span class="n">fail_count</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># write report to disk</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">report</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">report</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="p">))</span></div>

<div class="viewcode-block" id="TcExRun.run"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the App using the current profile.</span>

<span class="sd">        The current profile has the install_json and args pre-loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">install_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install_json&#39;</span><span class="p">)</span>
        <span class="n">program_language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install_json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;programLanguage&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">install_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;programMain&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">program_main</span> <span class="o">=</span> <span class="n">install_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;programMain&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO: remove this option on version 1.0.0</span>
            <span class="n">program_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">No Program Main or Script defined.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">run_display_profile</span><span class="p">(</span><span class="n">program_main</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_display_description</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_validate_program_main</span><span class="p">(</span><span class="n">program_main</span><span class="p">)</span>

        <span class="c1"># get the commands</span>
        <span class="n">commands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_commands</span><span class="p">(</span><span class="n">program_language</span><span class="p">,</span> <span class="n">program_main</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[run] Running command </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commands</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;print_command&#39;</span><span class="p">)))</span>

        <span class="c1"># output command</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s1">&#39;Executing: </span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span><span class="p">,</span> <span class="n">commands</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;print_command&#39;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">docker</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_docker</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_local</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.run_commands"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.run_commands">[docs]</a>    <span class="k">def</span> <span class="nf">run_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program_language</span><span class="p">,</span> <span class="n">program_main</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the run Print Command.&quot;&quot;&quot;</span>
        <span class="c1"># build the command</span>
        <span class="k">if</span> <span class="n">program_language</span> <span class="o">==</span> <span class="s1">&#39;python&#39;</span><span class="p">:</span>
            <span class="n">python_exe</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span>
            <span class="n">ptvsd_host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">docker</span><span class="p">:</span>
                <span class="c1"># use the default python command in the container</span>
                <span class="n">python_exe</span> <span class="o">=</span> <span class="s1">&#39;python&#39;</span>
                <span class="n">ptvsd_host</span> <span class="o">=</span> <span class="s1">&#39;0.0.0.0&#39;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">vscd</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_environment</span><span class="p">()</span>  <span class="c1"># update PYTHONPATH for local testing</span>
                <span class="n">command</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">python_exe</span><span class="p">,</span>
                    <span class="s1">&#39;-m&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ptvsd&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;--host&#39;</span><span class="p">,</span>
                    <span class="n">ptvsd_host</span><span class="p">,</span>
                    <span class="s1">&#39;--port&#39;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">vscd_port</span><span class="p">,</span>
                    <span class="s1">&#39;--wait&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.py&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program_main</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">python_exe</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">program_main</span><span class="p">]</span>

            <span class="c1"># exe command</span>
            <span class="n">cli_command</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">command</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_args&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">standard</span><span class="p">]</span>

            <span class="c1"># print command</span>
            <span class="c1"># print_command = &#39; &#39;.join(command + self.profile.get(&#39;profile_args&#39;).masked)</span>
            <span class="n">print_command</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">command</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_args&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">masked</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">unmask</span><span class="p">:</span>
                <span class="c1"># print_command = &#39; &#39;.join(command + self.profile.get(&#39;profile_args&#39;).quoted)</span>
                <span class="n">print_command</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">command</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_args&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">quoted</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">program_language</span> <span class="o">==</span> <span class="s1">&#39;java&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">docker</span><span class="p">:</span>
                <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;java&#39;</span><span class="p">,</span> <span class="s1">&#39;-cp&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class_path&#39;</span><span class="p">,</span> <span class="s1">&#39;./target/*&#39;</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">command</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;java_path&#39;</span><span class="p">,</span> <span class="n">program_language</span><span class="p">),</span>
                    <span class="s1">&#39;-cp&#39;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class_path&#39;</span><span class="p">,</span> <span class="s1">&#39;./target/*&#39;</span><span class="p">),</span>
                <span class="p">]</span>

            <span class="c1"># exe command</span>
            <span class="n">cli_command</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_args&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">standard</span> <span class="o">+</span> <span class="p">[</span><span class="n">program_main</span><span class="p">]</span>

            <span class="c1"># print command</span>
            <span class="n">print_command</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">command</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_args&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">masked</span> <span class="o">+</span> <span class="p">[</span><span class="n">program_main</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">unmask</span><span class="p">:</span>
                <span class="n">print_command</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">command</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_args&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">quoted</span> <span class="o">+</span> <span class="p">[</span><span class="n">program_main</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;cli_command&#39;</span><span class="p">:</span> <span class="n">cli_command</span><span class="p">,</span> <span class="s1">&#39;print_command&#39;</span><span class="p">:</span> <span class="n">print_command</span><span class="p">}</span></div>

<div class="viewcode-block" id="TcExRun.run_local"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.run_local">[docs]</a>    <span class="k">def</span> <span class="nf">run_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commands</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the App on local system.&quot;&quot;&quot;</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
            <span class="n">commands</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cli_command&#39;</span><span class="p">),</span>
            <span class="n">shell</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shell</span><span class="p">,</span>
            <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

        <span class="c1"># display app output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_display_app_output</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_display_app_errors</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="c1"># Exit Code</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_exit_code</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">returncode</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.run_docker"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.run_docker">[docs]</a>    <span class="k">def</span> <span class="nf">run_docker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commands</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run App in Docker Container.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">docker</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">Could not import docker module (try &quot;pip install docker&quot;).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># app_args = self.profile.get(&#39;profile_args&#39;).standard</span>
        <span class="n">app_args_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_args&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
        <span class="n">install_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install_json&#39;</span><span class="p">)</span>

        <span class="c1"># client</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="n">from_env</span><span class="p">()</span>

        <span class="c1"># app data</span>
        <span class="n">app_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="c1"># app_path = &#39;{}/{}&#39;.format(app_dir, program_main)</span>

        <span class="c1"># ports</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">vscd</span><span class="p">:</span>
            <span class="n">ports</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/tcp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">vscd_port</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">vscd_port</span><span class="p">}</span>

        <span class="c1"># volumes</span>
        <span class="n">volumes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">in_path</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">app_dir</span><span class="p">,</span> <span class="n">app_args_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tc_in_path&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">app_args_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tc_in_path&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">volumes</span><span class="p">[</span><span class="n">in_path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bind&#39;</span><span class="p">:</span> <span class="n">in_path</span><span class="p">}</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">app_dir</span><span class="p">,</span> <span class="n">app_args_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tc_log_path&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">app_args_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tc_log_path&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">volumes</span><span class="p">[</span><span class="n">log_path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bind&#39;</span><span class="p">:</span> <span class="n">log_path</span><span class="p">}</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">app_dir</span><span class="p">,</span> <span class="n">app_args_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tc_out_path&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">app_args_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tc_out_path&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">volumes</span><span class="p">[</span><span class="n">out_path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bind&#39;</span><span class="p">:</span> <span class="n">out_path</span><span class="p">}</span>
        <span class="n">temp_path</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">app_dir</span><span class="p">,</span> <span class="n">app_args_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tc_temp_path&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">app_args_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tc_temp_path&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">volumes</span><span class="p">[</span><span class="n">temp_path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bind&#39;</span><span class="p">:</span> <span class="n">temp_path</span><span class="p">}</span>
        <span class="n">volumes</span><span class="p">[</span><span class="n">app_dir</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bind&#39;</span><span class="p">:</span> <span class="n">app_dir</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">docker_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># user docker image from cli as an override.</span>
            <span class="n">docker_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">docker_image</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># docker image from install.json can be overridden by docker image in profile. if no</span>
            <span class="c1"># image is defined in either file use the default image define as self.docker_image.</span>
            <span class="n">docker_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s1">&#39;dockerImage&#39;</span><span class="p">,</span> <span class="n">install_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dockerImage&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">docker_image</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">status_code</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">containers</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">docker_image</span><span class="p">,</span>
                <span class="n">entrypoint</span><span class="o">=</span><span class="n">commands</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cli_command&#39;</span><span class="p">),</span>
                <span class="n">environment</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PYTHONPATH=</span><span class="si">{}</span><span class="s1">/lib_latest&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">app_dir</span><span class="p">)],</span>
                <span class="n">detach</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="c1"># network_mode=install_json.get(&#39;docker_host&#39;, &#39;host&#39;),</span>
                <span class="n">ports</span><span class="o">=</span><span class="n">ports</span><span class="p">,</span>
                <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">volumes</span><span class="o">=</span><span class="n">volumes</span><span class="p">,</span>
                <span class="n">working_dir</span><span class="o">=</span><span class="n">app_dir</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="n">status_code</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StatusCode&#39;</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">error</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="c1"># Exit Code</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_exit_code</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.run_display_app_errors"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.run_display_app_errors">[docs]</a>    <span class="k">def</span> <span class="nf">run_display_app_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">err</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle the exit code for the current run.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e_</span> <span class="ow">in</span> <span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">e_</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;[tcrun] App error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e_</span><span class="p">))</span></div>

<div class="viewcode-block" id="TcExRun.run_display_app_output"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.run_display_app_output">[docs]</a>    <span class="k">def</span> <span class="nf">run_display_app_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print any App output.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;quiet&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;App Output:&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">CYAN</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;[tcrun] App output: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">o</span><span class="p">))</span></div>

<div class="viewcode-block" id="TcExRun.run_display_description"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.run_display_description">[docs]</a>    <span class="k">def</span> <span class="nf">run_display_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print profile name with programMain.&quot;&quot;&quot;</span>
        <span class="c1"># display description if available</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;Description: </span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">MAGENTA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.run_display_profile"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.run_display_profile">[docs]</a>    <span class="k">def</span> <span class="nf">run_display_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program_main</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print profile name with programMain.&quot;&quot;&quot;</span>
        <span class="n">install_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install_json&#39;</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;Profile: &#39;</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{}{}{}{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">CYAN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_name&#39;</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span>
        <span class="p">)</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;[</span><span class="si">{}{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">MAGENTA</span><span class="p">,</span> <span class="n">program_main</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">install_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;programVersion&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{}{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span>
                <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">MAGENTA</span><span class="p">,</span>
                <span class="n">install_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;programVersion&#39;</span><span class="p">),</span>
                <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.run_exit_code"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.run_exit_code">[docs]</a>    <span class="k">def</span> <span class="nf">run_exit_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">returncode</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle the exit code for the current run.&quot;&quot;&quot;</span>
        <span class="n">exit_status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[run] Exit Code </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">returncode</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="o">.</span><span class="n">increment_total</span><span class="p">()</span>  <span class="c1"># increment report execution total</span>
        <span class="n">valid_exit_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exit_codes&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="o">.</span><span class="n">exit_code</span><span class="p">(</span><span class="n">returncode</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">returncode</span> <span class="ow">in</span> <span class="n">valid_exit_codes</span><span class="p">:</span>
            <span class="n">exit_status</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="o">.</span><span class="n">profile_execution</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;App Exit Code: </span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span><span class="p">,</span> <span class="n">returncode</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;App Exit Code: </span><span class="si">{}{}{}{}</span><span class="s1"> (Valid Exit Codes: </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span>
                    <span class="n">returncode</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RESET</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exit_codes&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="o">.</span><span class="n">profile_execution</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">halt_on_fail</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;App exited with invalid exit code </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">returncode</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">exit_status</span></div>

<div class="viewcode-block" id="TcExRun.run_validate_program_main"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.run_validate_program_main">[docs]</a>    <span class="k">def</span> <span class="nf">run_validate_program_main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program_main</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate the program main file exists.&quot;&quot;&quot;</span>
        <span class="n">program_language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;install_json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;programLanguage&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">program_language</span> <span class="o">==</span> <span class="s1">&#39;python&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.py&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program_main</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">Could not find program main file (</span><span class="si">{}</span><span class="s1">).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">program_main</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.stage"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.stage">[docs]</a>    <span class="k">def</span> <span class="nf">stage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stage Redis and ThreatConnect data defined in profile.</span>

<span class="sd">        Redis Data:</span>

<span class="sd">        .. code-block:: javascript</span>

<span class="sd">            {</span>
<span class="sd">                &quot;data&quot;: [</span>
<span class="sd">                    &quot;This is an example Source #1&quot;,</span>
<span class="sd">                    &quot;This is an example Source #2&quot;</span>
<span class="sd">                ],</span>
<span class="sd">                &quot;variable&quot;: &quot;#App:1234:source!StringArray&quot;</span>
<span class="sd">            }</span>

<span class="sd">        Redis Array:</span>

<span class="sd">        .. code-block:: javascript</span>

<span class="sd">            {</span>
<span class="sd">                &quot;data&quot;: {</span>
<span class="sd">                    &quot;variables&quot;: [{</span>
<span class="sd">                        &quot;value&quot;: &quot;#App:4768:tc.adversary!TCEntity&quot;,</span>
<span class="sd">                    }, {</span>
<span class="sd">                        &quot;value&quot;: &quot;#App:4768:tc.threat!TCEntity&quot;,</span>
<span class="sd">                    }]</span>
<span class="sd">                },</span>
<span class="sd">                &quot;data_type&quot;: &quot;redis_array&quot;,</span>
<span class="sd">                &quot;variable&quot;: &quot;#App:4768:groups!TCEntityArray&quot;</span>
<span class="sd">            },</span>
<span class="sd">            {</span>
<span class="sd">                &quot;data&quot;: {</span>
<span class="sd">                    &quot;variables&quot;: [{</span>
<span class="sd">                        &quot;value&quot;: &quot;#App:4768:tc.adversary!TCEntity&quot;,</span>
<span class="sd">                        &quot;path&quot;: &quot;.name&quot;</span>
<span class="sd">                    }, {</span>
<span class="sd">                        &quot;value&quot;: &quot;#App:4768:tc.threat!TCEntity&quot;,</span>
<span class="sd">                        &quot;path&quot;: &quot;.name&quot;</span>
<span class="sd">                    }]</span>
<span class="sd">                },</span>
<span class="sd">                &quot;data_type&quot;: &quot;redis_array&quot;,</span>
<span class="sd">                &quot;variable&quot;: &quot;#App:4768:groups!StringArray&quot;</span>
<span class="sd">            }</span>

<span class="sd">        ThreatConnect Data:</span>

<span class="sd">        .. code-block:: javascript</span>

<span class="sd">            {</span>
<span class="sd">                &quot;data&quot;: {</span>
<span class="sd">                    &quot;group&quot;: [{</span>
<span class="sd">                        &quot;firstSeen&quot;: &quot;2008-12-12T12:00:00Z&quot;,</span>
<span class="sd">                        &quot;name&quot;: &quot;campaign-002&quot;,</span>
<span class="sd">                        &quot;type&quot;: &quot;Campaign&quot;,</span>
<span class="sd">                        &quot;xid&quot;: &quot;camp-0002&quot;,</span>
<span class="sd">                        &quot;attribute&quot;: [{</span>
<span class="sd">                            &quot;displayed&quot;: True,</span>
<span class="sd">                            &quot;type&quot;: &quot;Description&quot;,</span>
<span class="sd">                            &quot;value&quot;: &quot;Campaign Example Description&quot;</span>
<span class="sd">                        }],</span>
<span class="sd">                        &quot;tag&quot;: [{</span>
<span class="sd">                            &quot;name&quot;: &quot;SafeToDelete&quot;</span>
<span class="sd">                        }],</span>
<span class="sd">                        &quot;variable&quot;: &quot;#App:4768:tc.campaign!TCEntity&quot;</span>
<span class="sd">                    }],</span>
<span class="sd">                    &quot;indicator&quot;: [{</span>
<span class="sd">                        &quot;associatedGroups&quot;: [</span>
<span class="sd">                            {</span>
<span class="sd">                                &quot;groupXid&quot;: &quot;campaign-002&quot;</span>
<span class="sd">                            }</span>
<span class="sd">                        ],</span>
<span class="sd">                        &quot;confidence&quot;: 100,</span>
<span class="sd">                        &quot;fileOccurrence&quot;: [</span>
<span class="sd">                            {</span>
<span class="sd">                                &quot;date&quot;: &quot;2017-02-02T01:02:03Z&quot;,</span>
<span class="sd">                                &quot;fileName&quot;: &quot;drop1.exe&quot;,</span>
<span class="sd">                                &quot;path&quot;: &quot;C:\\\\test\\\\&quot;</span>
<span class="sd">                            }</span>
<span class="sd">                        ],</span>
<span class="sd">                        &quot;rating&quot;: 5.0,</span>
<span class="sd">                        &quot;summary&quot;: &quot;43c3609411c83f363e051d455ade78a6&quot;,</span>
<span class="sd">                        &quot;tag&quot;: [</span>
<span class="sd">                            {</span>
<span class="sd">                                &quot;name&quot;: &quot;SafeToDelete&quot;</span>
<span class="sd">                            }</span>
<span class="sd">                        ],</span>
<span class="sd">                        &quot;type&quot;: &quot;File&quot;,</span>
<span class="sd">                        &quot;xid&quot;: &quot;55ee19565db5b16a0f511791a3b2a7ef0ccddf4d9d64e7008561329419cb675b&quot;,</span>
<span class="sd">                        &quot;variable&quot;: &quot;#App:4768:tc.file!TCEntity&quot;</span>
<span class="sd">                    }]</span>
<span class="sd">                },</span>
<span class="sd">                &quot;data_owner&quot;: &quot;TCI&quot;,</span>
<span class="sd">                &quot;data_type&quot;: &quot;threatconnect&quot;</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">staging_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># reported issue from qa where staging data is invalid</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Invalid staging data provided (</span><span class="si">{}</span><span class="s1">).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_type&#39;</span><span class="p">,</span> <span class="s1">&#39;redis&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;redis&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Stage Redis Data&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stage_redis</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">),</span> <span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;redis-array&#39;</span><span class="p">,</span> <span class="s1">&#39;redis_array&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Stage Redis Array&#39;</span><span class="p">)</span>
                <span class="n">out_variable</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span>
                <span class="c1"># build array</span>
                <span class="n">redis_array</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variables&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
                    <span class="n">variable</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;Binary&#39;</span><span class="p">):</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">read_binary</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">variable</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;BinaryArray&#39;</span><span class="p">):</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">read_binary_array</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">variable</span><span class="p">),</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">))</span>
                    <span class="c1"># TODO: should None value be appended?</span>
                    <span class="n">redis_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stage_redis</span><span class="p">(</span><span class="n">out_variable</span><span class="p">,</span> <span class="n">redis_array</span><span class="p">)</span>
                <span class="c1"># print(redis_array)</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;threatconnect&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Stage ThreatConnect Data&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stage_tc</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_owner&#39;</span><span class="p">),</span> <span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;threatconnect-association&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Stage ThreatConnect Association Data&#39;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stage_tc_associations</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;entity1&#39;</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;entity2&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;threatconnect-batch&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Stage ThreatConnect Batch Data&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stage_tc_batch</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_owner&#39;</span><span class="p">),</span> <span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">{}))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">staging_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read data files and return all staging data for current profile.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staging_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">staging_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">staging_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_files&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">staging_file</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s1">&#39;Staging Data: </span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">MAGENTA</span><span class="p">,</span> <span class="n">staging_file</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[stage] Staging data file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">staging_file</span><span class="p">))</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">staging_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                    <span class="n">staging_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">Could not find file </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">staging_file</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_staging_data</span> <span class="o">=</span> <span class="n">staging_data</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_staging_data</span>

<div class="viewcode-block" id="TcExRun.stage_redis"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.stage_redis">[docs]</a>    <span class="k">def</span> <span class="nf">stage_redis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stage data in Redis.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># handle binary</span>
        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;Binary&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">binascii</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;The Binary staging data for variable </span><span class="si">{}</span><span class="s1"> is not properly base64 encoded.&#39;</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">variable</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;BinaryArray&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># loop through each entry</span>
                <span class="n">decoded_data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">d_decoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                    <span class="n">decoded_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d_decoded</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">decoded_data</span>
            <span class="k">except</span> <span class="n">binascii</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;The BinaryArray staging data for variable </span><span class="si">{}</span><span class="s1"> is not properly base64 encoded.&#39;</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;[stage] Creating variable </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.stage_tc"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.stage_tc">[docs]</a>    <span class="k">def</span> <span class="nf">stage_tc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">staging_data</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stage data using ThreatConnect API.</span>

<span class="sd">        .. code-block:: javascript</span>

<span class="sd">            [{</span>
<span class="sd">              &quot;data&quot;: {</span>
<span class="sd">                &quot;id&quot;: 116,</span>
<span class="sd">                &quot;value&quot;: &quot;adversary001-build-testing&quot;,</span>
<span class="sd">                &quot;type&quot;: &quot;Adversary&quot;,</span>
<span class="sd">                &quot;ownerName&quot;: &quot;qa-build&quot;,</span>
<span class="sd">                &quot;dateAdded&quot;: &quot;2017-08-16T18:35:07-04:00&quot;,</span>
<span class="sd">                &quot;webLink&quot;: &quot;https://app.tci.ninja/auth/adversary/adversary.xhtml?adversary=116&quot;</span>
<span class="sd">              },</span>
<span class="sd">              &quot;data_type&quot;: &quot;redis&quot;,</span>
<span class="sd">              &quot;variable&quot;: &quot;#App:0822:adversary!TCEntity&quot;</span>
<span class="sd">            }]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># parse resource_data</span>
        <span class="n">resource_type</span> <span class="o">=</span> <span class="n">staging_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">resource_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">indicator_types</span> <span class="ow">or</span> <span class="n">resource_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">group_types</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">attributes</span> <span class="o">=</span> <span class="n">staging_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;attribute&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">attributes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">security_labels</span> <span class="o">=</span> <span class="n">staging_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;security_label&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">security_labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tags</span> <span class="o">=</span> <span class="n">staging_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tag&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="n">resource_type</span><span class="p">)</span>
            <span class="n">resource</span><span class="o">.</span><span class="n">http_method</span> <span class="o">=</span> <span class="s1">&#39;POST&#39;</span>
            <span class="n">resource</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>

            <span class="c1"># special case for Email Group Type</span>
            <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="s1">&#39;Email&#39;</span><span class="p">:</span>
                <span class="n">resource</span><span class="o">.</span><span class="n">add_payload</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">,</span> <span class="s1">&#39;createVictims&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;body: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">staging_data</span><span class="p">))</span>
            <span class="n">resource</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">staging_data</span><span class="p">)</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Success&#39;</span><span class="p">:</span>
                <span class="c1"># add resource id</span>
                <span class="k">if</span> <span class="n">resource_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">indicator_types</span><span class="p">:</span>
                    <span class="n">resource_id</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s1">&#39;[stage] Creating resource </span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resource_type</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">resource_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">group_types</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s1">&#39;[stage] Creating resource </span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">resource_type</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">resource_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;[stage] resource_id: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resource_id</span><span class="p">))</span>
                <span class="n">resource</span><span class="o">.</span><span class="n">resource_id</span><span class="p">(</span><span class="n">resource_id</span><span class="p">)</span>

                <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">json_to_entity</span><span class="p">(</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">),</span> <span class="n">resource</span><span class="o">.</span><span class="n">value_fields</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">parent</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;[stage] Creating Entity: </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">stage_redis</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># self.tcex.playbook.create_tc_entity(variable, entity[0])</span>

                <span class="c1"># update metadata</span>
                <span class="k">for</span> <span class="n">attribute_data</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stage_tc_create_attribute</span><span class="p">(</span>
                        <span class="n">attribute_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">),</span> <span class="n">attribute_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="n">resource</span>
                    <span class="p">)</span>
                <span class="k">for</span> <span class="n">label_data</span> <span class="ow">in</span> <span class="n">security_labels</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stage_tc_create_security_label</span><span class="p">(</span><span class="n">label_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="n">resource</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">tag_data</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stage_tc_create_tag</span><span class="p">(</span><span class="n">tag_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="n">resource</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;[stage] Unsupported resource type </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resource_type</span><span class="p">))</span></div>

<div class="viewcode-block" id="TcExRun.stage_tc_create_attribute"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.stage_tc_create_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">stage_tc_create_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_type</span><span class="p">,</span> <span class="n">attribute_value</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add an attribute to a resource.&quot;&quot;&quot;</span>
        <span class="n">attribute_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">attribute_type</span><span class="p">),</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">attribute_value</span><span class="p">)}</span>
        <span class="c1"># handle default description and source</span>
        <span class="k">if</span> <span class="n">attribute_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">,</span> <span class="s1">&#39;Source&#39;</span><span class="p">]:</span>
            <span class="n">attribute_data</span><span class="p">[</span><span class="s1">&#39;displayed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">attrib_resource</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span>
        <span class="n">attrib_resource</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">attribute_data</span><span class="p">)</span>
        <span class="n">attrib_resource</span><span class="o">.</span><span class="n">http_method</span> <span class="o">=</span> <span class="s1">&#39;POST&#39;</span>

        <span class="c1"># add the attribute</span>
        <span class="n">a_response</span> <span class="o">=</span> <span class="n">attrib_resource</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">a_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Success&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;[stage] Failed adding attribute type &quot;</span><span class="si">{}</span><span class="s1">&quot;:&quot;</span><span class="si">{}</span><span class="s1">&quot; (</span><span class="si">{}</span><span class="s1">).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">attribute_type</span><span class="p">,</span> <span class="n">attribute_value</span><span class="p">,</span> <span class="n">a_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.stage_tc_create_security_label"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.stage_tc_create_security_label">[docs]</a>    <span class="k">def</span> <span class="nf">stage_tc_create_security_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a security label to a resource.&quot;&quot;&quot;</span>
        <span class="n">sl_resource</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">security_labels</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">sl_resource</span><span class="o">.</span><span class="n">http_method</span> <span class="o">=</span> <span class="s1">&#39;POST&#39;</span>
        <span class="n">sl_response</span> <span class="o">=</span> <span class="n">sl_resource</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sl_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Success&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;[tcex] Failed adding security label &quot;</span><span class="si">{}</span><span class="s1">&quot; (</span><span class="si">{}</span><span class="s1">).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">label</span><span class="p">,</span> <span class="n">sl_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.stage_tc_create_tag"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.stage_tc_create_tag">[docs]</a>    <span class="k">def</span> <span class="nf">stage_tc_create_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a tag to a resource.&quot;&quot;&quot;</span>
        <span class="n">tag_resource</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">tags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">safetag</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
        <span class="n">tag_resource</span><span class="o">.</span><span class="n">http_method</span> <span class="o">=</span> <span class="s1">&#39;POST&#39;</span>
        <span class="n">t_response</span> <span class="o">=</span> <span class="n">tag_resource</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">t_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Success&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;[tcex] Failed adding tag &quot;</span><span class="si">{}</span><span class="s1">&quot; (</span><span class="si">{}</span><span class="s1">).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">t_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.stage_tc_associations"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.stage_tc_associations">[docs]</a>    <span class="k">def</span> <span class="nf">stage_tc_associations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add an attribute to a resource.&quot;&quot;&quot;</span>
        <span class="c1"># resource 1</span>
        <span class="n">entity1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">entity1</span><span class="p">)</span>
        <span class="n">entity1_id</span> <span class="o">=</span> <span class="n">entity1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="n">entity1_owner</span> <span class="o">=</span> <span class="n">entity1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ownerName&#39;</span><span class="p">)</span>
        <span class="n">entity1_type</span> <span class="o">=</span> <span class="n">entity1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">entity1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">indicator_types</span><span class="p">:</span>
            <span class="n">entity1_id</span> <span class="o">=</span> <span class="n">entity1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

        <span class="c1"># resource 2</span>
        <span class="n">entity2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">entity2</span><span class="p">)</span>
        <span class="n">entity2_id</span> <span class="o">=</span> <span class="n">entity2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="n">entity2_owner</span> <span class="o">=</span> <span class="n">entity1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ownerName&#39;</span><span class="p">)</span>
        <span class="n">entity2_type</span> <span class="o">=</span> <span class="n">entity2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">entity2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">indicator_types</span><span class="p">:</span>
            <span class="n">entity2_id</span> <span class="o">=</span> <span class="n">entity2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">entity1_owner</span> <span class="o">!=</span> <span class="n">entity2_owner</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;[stage] Can not associate resource across owners.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">resource1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="n">entity1_type</span><span class="p">)</span>
        <span class="n">resource1</span><span class="o">.</span><span class="n">http_method</span> <span class="o">=</span> <span class="s1">&#39;POST&#39;</span>
        <span class="n">resource1</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">entity1_owner</span>
        <span class="n">resource1</span><span class="o">.</span><span class="n">resource_id</span><span class="p">(</span><span class="n">entity1_id</span><span class="p">)</span>

        <span class="n">resource2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="n">entity2_type</span><span class="p">)</span>
        <span class="n">resource2</span><span class="o">.</span><span class="n">resource_id</span><span class="p">(</span><span class="n">entity2_id</span><span class="p">)</span>

        <span class="n">a_resource</span> <span class="o">=</span> <span class="n">resource1</span><span class="o">.</span><span class="n">associations</span><span class="p">(</span><span class="n">resource2</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">a_resource</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Success&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;[stage] Failed associating &quot;</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">&quot; with &quot;</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">&quot; (</span><span class="si">{}</span><span class="s1">).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">entity1_type</span><span class="p">,</span>
                    <span class="n">entity1_id</span><span class="p">,</span>
                    <span class="n">entity2_type</span><span class="p">,</span>
                    <span class="n">entity2_id</span><span class="p">,</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.stage_tc_batch"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.stage_tc_batch">[docs]</a>    <span class="k">def</span> <span class="nf">stage_tc_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">staging_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stage data in Redis.&quot;&quot;&quot;</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">owner</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">staging_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="c1"># add to redis</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_data</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="c1"># update group data</span>
            <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xid&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># add xid if one doesn&#39;t exist</span>
                <span class="n">group</span><span class="p">[</span><span class="s1">&#39;xid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_tc_batch_xid</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">),</span> <span class="n">group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="n">owner</span><span class="p">)</span>
            <span class="c1"># add owner name</span>
            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;ownerName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">owner</span>
            <span class="c1"># add to batch</span>
            <span class="n">batch</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="c1"># create tcentity</span>
            <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stage_redis</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_tc_group_entity</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">staging_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;indicator&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="c1"># add to redis</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">indicator</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">indicator</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">indicator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xid&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">indicator</span><span class="p">[</span><span class="s1">&#39;xid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_tc_batch_xid</span><span class="p">(</span>
                    <span class="n">indicator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">),</span> <span class="n">indicator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;summary&#39;</span><span class="p">),</span> <span class="n">owner</span>
                <span class="p">)</span>
            <span class="n">indicator</span><span class="p">[</span><span class="s1">&#39;ownerName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">owner</span>
            <span class="c1"># add to batch after extra data has been popped</span>
            <span class="n">batch</span><span class="o">.</span><span class="n">add_indicator</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_data</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">indicator</span><span class="p">),</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># if isinstance(data, (dict)):</span>
                <span class="c1"># tcentity uses value as the name</span>
                <span class="c1">#     data[&#39;value&#39;] = data.pop(&#39;summary&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stage_redis</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_tc_indicator_entity</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="c1"># submit batch</span>
        <span class="n">batch_results</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;[stage] Batch Results: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">batch_results</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">batch_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;errors&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;[stage] </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">))</span></div>

<div class="viewcode-block" id="TcExRun.stage_tc_batch_xid"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.stage_tc_batch_xid">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">stage_tc_batch_xid</span><span class="p">(</span><span class="n">xid_type</span><span class="p">,</span> <span class="n">xid_value</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an xid for a batch job.&quot;&quot;&quot;</span>
        <span class="n">xid_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xid_type</span><span class="p">,</span> <span class="n">xid_value</span><span class="p">,</span> <span class="n">owner</span><span class="p">)</span>
        <span class="n">hash_object</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">xid_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">hash_object</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></div>

<div class="viewcode-block" id="TcExRun.stage_tc_group_entity"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.stage_tc_group_entity">[docs]</a>    <span class="k">def</span> <span class="nf">stage_tc_group_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert JSON data to TCEntity.&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;@.{name: name, type: type, ownerName: ownerName}&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_data</span><span class="p">(</span><span class="n">group_data</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.stage_tc_indicator_entity"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.stage_tc_indicator_entity">[docs]</a>    <span class="k">def</span> <span class="nf">stage_tc_indicator_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indicator_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert JSON data to TCEntity.&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;@.{value: summary, &#39;</span>
        <span class="n">path</span> <span class="o">+=</span> <span class="s1">&#39;type: type, &#39;</span>
        <span class="n">path</span> <span class="o">+=</span> <span class="s1">&#39;ownerName: ownerName, &#39;</span>
        <span class="n">path</span> <span class="o">+=</span> <span class="s1">&#39;confidence: confidence || `0`, &#39;</span>
        <span class="n">path</span> <span class="o">+=</span> <span class="s1">&#39;rating: rating || `0`}&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_data</span><span class="p">(</span><span class="n">indicator_data</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.update_environment"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.update_environment">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_environment</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Run the App as a subprocess.&quot;&quot;&quot;</span>
        <span class="n">lib_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;lib_latest&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;PYTHONPATH&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PYTHONPATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">lib_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PYTHONPATH&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PYTHONPATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lib_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="TcExRun.validate"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate data in Redis.&quot;&quot;&quot;</span>
        <span class="n">passed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;validations&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_type&#39;</span><span class="p">,</span> <span class="s1">&#39;redis&#39;</span><span class="p">)</span>  <span class="c1"># default to redis for older data files</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;redis&#39;</span><span class="p">:</span>
                <span class="n">user_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
                <span class="n">user_data_path</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_path&#39;</span><span class="p">)</span>  <span class="c1"># jmespath expression</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="n">string_types</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vars_match</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
                    <span class="c1"># if user_data reference a redis variable retrieve the data</span>
                    <span class="k">if</span> <span class="n">user_data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;Binary&#39;</span><span class="p">):</span>
                        <span class="c1"># call specific method and do not decode data</span>
                        <span class="n">user_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">read_binary</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">user_data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;BinaryArray&#39;</span><span class="p">):</span>
                        <span class="c1"># call specific method and do not decode data</span>
                        <span class="n">user_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">read_binary_array</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">user_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">user_data_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">user_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_data</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="n">user_data_path</span><span class="p">)</span>

                <span class="c1"># get db variable/data</span>
                <span class="n">variable</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;Binary&#39;</span><span class="p">):</span>
                    <span class="c1"># call specific method and do not decode data</span>
                    <span class="n">db_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">read_binary</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">variable</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;BinaryArray&#39;</span><span class="p">):</span>
                    <span class="c1"># call specific method and do not decode data</span>
                    <span class="n">db_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">read_binary_array</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">db_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
                <span class="n">db_data_path</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable_path&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">db_data_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">db_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_data</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">db_data_path</span><span class="p">)</span>

                <span class="c1"># operator</span>
                <span class="n">oper</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operator&#39;</span><span class="p">,</span> <span class="s1">&#39;eq&#39;</span><span class="p">)</span>

                <span class="c1"># validate if possible</span>
                <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">10</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">variable</span><span class="p">))</span>
                <span class="c1"># self.log.info(&#39;[validate] Variable  : {}&#39;.format(variable))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_redis</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
                    <span class="n">passed</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># if any validation fails everything fails</span>
        <span class="k">return</span> <span class="n">passed</span></div>

<div class="viewcode-block" id="TcExRun.validate_redis"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.validate_redis">[docs]</a>    <span class="k">def</span> <span class="nf">validate_redis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate data in Redis.&quot;&quot;&quot;</span>
        <span class="n">passed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># convert any int to string since playbooks don&#39;t support int values</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">db_data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">db_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">user_data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span>

        <span class="c1"># try to sort list of strings for simple comparisons</span>
        <span class="c1"># if list has a more complex data structure the sort will fail</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">db_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">db_data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c1"># self.log.debug(&#39;[validate] could not sort list&#39;)</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">user_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c1"># self.log.debug(&#39;[validate] could not sort list&#39;)</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">oper</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Invalid operator provided (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oper</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># compare the data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">oper</span><span class="p">)(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="o">.</span><span class="n">profile_validation</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="o">.</span><span class="n">profile_validation</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">passed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># log validation data in a readable format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_log_output</span><span class="p">(</span><span class="n">passed</span><span class="p">,</span> <span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">,</span> <span class="n">oper</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">passed</span></div>

<div class="viewcode-block" id="TcExRun.validate_log_output"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.TcExRun.validate_log_output">[docs]</a>    <span class="k">def</span> <span class="nf">validate_log_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">passed</span><span class="p">,</span> <span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format the validation log output to be easier to read.&quot;&quot;&quot;</span>
        <span class="n">truncate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">truncate</span>
        <span class="k">if</span> <span class="n">db_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">passed</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="p">(</span><span class="n">string_types</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">db_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">truncate</span><span class="p">:</span>
                <span class="n">db_data</span> <span class="o">=</span> <span class="n">db_data</span><span class="p">[:</span><span class="n">truncate</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span>
                <span class="n">db_data_truncated</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">db_data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">string_types</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">truncate</span><span class="p">:</span>
                        <span class="n">db_data_truncated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">truncate</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">db_data_truncated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="n">db_data</span> <span class="o">=</span> <span class="n">db_data_truncated</span>

        <span class="k">if</span> <span class="n">user_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">passed</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="p">(</span><span class="n">string_types</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">truncate</span><span class="p">:</span>
                <span class="n">user_data</span> <span class="o">=</span> <span class="n">user_data</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">truncate</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span>
                <span class="n">user_data_truncated</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">user_data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="p">(</span><span class="n">string_types</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">truncate</span><span class="p">:</span>
                        <span class="n">user_data_truncated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">truncate</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">user_data_truncated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
                <span class="n">user_data</span> <span class="o">=</span> <span class="n">user_data_truncated</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[validate] DB Data   : (</span><span class="si">{}</span><span class="s1">), Type: [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">db_data</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[validate] Operator  : (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oper</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[validate] User Data : (</span><span class="si">{}</span><span class="s1">), Type: [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">user_data</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">passed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[validate] Results   : Passed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;[validate] Results  : Failed&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">db_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">user_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">oper</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;ne&#39;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">diff_count</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">diff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">db_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>  <span class="c1"># no difference</span>
                            <span class="k">continue</span>
                        <span class="k">elif</span> <span class="n">diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                <span class="s1">&#39;[validate] Diff      : Missing data at index </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                            <span class="p">)</span>
                        <span class="k">elif</span> <span class="n">diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[validate] Diff      : Extra data at index </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">diff_count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_diff</span><span class="p">:</span>
                            <span class="c1"># don&#39;t spam the logs if string are vastly different</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Max number of differences reached.&#39;</span><span class="p">)</span>
                            <span class="k">break</span>
                        <span class="n">diff_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="c1"># halt all further actions</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">halt_on_fail</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Failed validating data.&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ArgBuilder"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.ArgBuilder">[docs]</a><span class="k">class</span> <span class="nc">ArgBuilder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object container for CLI Args.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize Class properties.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">=</span> <span class="n">lang</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args_masked</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args_quoted</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Build arg data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_args</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all data formatted for the provided language.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">masked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all args formatted for the provided language with sensitive data masked.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args_masked</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">quoted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all args formatted for the provided language with appropriate args quoted.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args_quoted</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">standard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all args formatted for the provided language.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span>

<div class="viewcode-block" id="ArgBuilder._add_arg_python"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.ArgBuilder._add_arg_python">[docs]</a>    <span class="k">def</span> <span class="nf">_add_arg_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add CLI Arg formatted specifically for Python.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (string): The CLI Args key (e.g., --name).</span>
<span class="sd">            value (string): The CLI Args value (e.g., bob).</span>
<span class="sd">            mask (boolean, default:False): Indicates whether no mask value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># boolean values are flags and should only be included when True</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args_quoted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args_masked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># boolean values are flags and cli arg should not have a value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_args_quoted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">mask</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_args_masked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArgBuilder._add_arg_java"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.ArgBuilder._add_arg_java">[docs]</a>    <span class="k">def</span> <span class="nf">_add_arg_java</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add CLI Arg formatted specifically for Java.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (string): The CLI Args key (e.g., --name).</span>
<span class="sd">            value (string): The CLI Args value (e.g., bob).</span>
<span class="sd">            mask (boolean, default:False): Indicates whether no mask value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;-D&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args_quoted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;-D&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">mask</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args_masked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;-D&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span></div>

<div class="viewcode-block" id="ArgBuilder._add_arg"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.ArgBuilder._add_arg">[docs]</a>    <span class="k">def</span> <span class="nf">_add_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add CLI Arg for the correct language.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (string): The CLI Args key (e.g., --name).</span>
<span class="sd">            value (string): The CLI Args value (e.g., bob).</span>
<span class="sd">            mask (boolean, default:False): Indicates whether no mask value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;python&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_arg_python</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;java&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_arg_java</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArgBuilder.add"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.ArgBuilder.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add CLI Arg to lists value.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (string): The CLI Args key (e.g., --name).</span>
<span class="sd">            value (string): The CLI Args value (e.g., bob).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># TODO: support env vars in list w/masked values</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_arg_python</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s1">&#39;Dictionary types are not currently supported for field.&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">env_var</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\$env\.(.*)$&#39;</span><span class="p">)</span>
            <span class="n">envs_var</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\$envs\.(.*)$&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">env_var</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
                <span class="c1"># read value from environment variable</span>
                <span class="n">env_key</span> <span class="o">=</span> <span class="n">env_var</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">env_key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">envs_var</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
                <span class="c1"># read secure value from environment variable</span>
                <span class="n">env_key</span> <span class="o">=</span> <span class="n">envs_var</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">env_key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_arg</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArgBuilder.quote"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.ArgBuilder.quote">[docs]</a>    <span class="k">def</span> <span class="nf">quote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Quote any parameters that contain spaces or special character.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (string): String containing parameters wrapped in double quotes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;python&#39;</span><span class="p">:</span>
            <span class="n">quote_char</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;java&#39;</span><span class="p">:</span>
            <span class="n">quote_char</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span>

        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[!\-\s\$\&amp;]{1,}&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}{1}{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quote_char</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="ArgBuilder.load"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.ArgBuilder.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load provided CLI Args.</span>

<span class="sd">        Args:</span>
<span class="sd">            args (dict): Dictionary of args in key/value format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">profile_args</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Report"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.Report">[docs]</a><span class="k">class</span> <span class="nc">Report</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Report Object for a single profile.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize class properties.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">),</span>
            <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;groups&#39;</span><span class="p">),</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_name&#39;</span><span class="p">),</span>
            <span class="s1">&#39;selected&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;valid_exit_codes&#39;</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exit_codes&#39;</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the report data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">execution_success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the profile/report execution_success.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;execution_success&#39;</span><span class="p">)</span>

    <span class="nd">@execution_success</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">execution_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">execution_success</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the profile/report execution_success.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;execution_success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution_success</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exit_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the profile/report exit_code.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exit_code&#39;</span><span class="p">)</span>

    <span class="nd">@exit_code</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">exit_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exit_code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the profile/report exit_code.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;exit_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exit_code</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the profile/report name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">selected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the profile/report name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">)</span>

    <span class="nd">@selected</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">selected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the profile/report name.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s1">&#39;selected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected</span>

<div class="viewcode-block" id="Report.__str__"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.Report.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return report as a string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Reports"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.Reports">[docs]</a><span class="k">class</span> <span class="nc">Reports</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object to hold the run report.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize class properties.&quot;&quot;&quot;</span>
        <span class="n">python_version</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">minor</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">micro</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;profiles&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;selected&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;unselected&#39;</span><span class="p">:</span> <span class="p">[]},</span>
            <span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;executions&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                <span class="s1">&#39;failed_profiles&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;validations&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="p">},</span>
            <span class="s1">&#39;settings&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s1">&#39;provided_group&#39;</span><span class="p">:</span> <span class="s1">&#39;qa-build&#39;</span><span class="p">,</span>
                <span class="s1">&#39;provided_profile&#39;</span><span class="p">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                <span class="s1">&#39;python_version&#39;</span><span class="p">:</span> <span class="n">python_version</span><span class="p">,</span>
                <span class="s1">&#39;selected_profiles&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;selected_profile_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;tcex_version&#39;</span><span class="p">:</span> <span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;tcex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
                <span class="s1">&#39;total_profile_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_profile</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Reports.add_profile"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.Reports.add_profile">[docs]</a>    <span class="k">def</span> <span class="nf">add_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">selected</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add profile to report.&quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">Report</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
        <span class="n">report</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="n">selected</span>
        <span class="k">if</span> <span class="n">selected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;selected_profiles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;selected_profile_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;total_profile_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">report</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">report</span></div>

<div class="viewcode-block" id="Reports.exit_code"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.Reports.exit_code">[docs]</a>    <span class="k">def</span> <span class="nf">exit_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the exit code on the selected profile.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_profile</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;exit_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code</span></div>

<div class="viewcode-block" id="Reports.increment_total"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.Reports.increment_total">[docs]</a>    <span class="k">def</span> <span class="nf">increment_total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return run total value.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Reports.profile"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.Reports.profile">[docs]</a>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a specific profile.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reports.profile_execution"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.Reports.profile_execution">[docs]</a>    <span class="k">def</span> <span class="nf">profile_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return run total value.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_profile</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;execution_success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;executions&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;executions&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_profile</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;failed_profiles&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;failed_profiles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_profile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reports.profile_validation"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.Reports.profile_validation">[docs]</a>    <span class="k">def</span> <span class="nf">profile_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return run total value.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_profile</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;validation_pass_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_profile</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;validation_fail_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_profile</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;validation_pass_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_profile</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;validation_fail_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Reports.report_validation"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.Reports.report_validation">[docs]</a>    <span class="k">def</span> <span class="nf">report_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return run total value.&quot;&quot;&quot;</span>
        <span class="c1"># only one fail/pass count per profile</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;validations&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;validations&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_profile</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;failed_profiles&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;failed_profiles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_profile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reports.__iter__"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.Reports.__iter__">[docs]</a>    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interate over all report profiles.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">profile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">profile</span></div>

<div class="viewcode-block" id="Reports.__str__"><a class="viewcode-back" href="../../tcex_docs/tcex.tcex_bin_run.html#tcex.tcex_bin_run.Reports.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return reports as a string.&quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span>
        <span class="k">for</span> <span class="n">profile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">profile</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">):</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="s1">&#39;selected&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="s1">&#39;unselected&#39;</span>
            <span class="k">del</span> <span class="n">profile</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;selected&#39;</span><span class="p">]</span>
            <span class="n">report</span><span class="p">[</span><span class="s1">&#39;profiles&#39;</span><span class="p">][</span><span class="n">selected</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>
</pre></div>

           </div>

          </div>
          <footer>


  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, ThreatConnect Inc

    </p>
  </div>

</footer>

        </div>
      </div>

    </section>

  </div>







      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>




  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
